<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Strategy Confirmation</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ai-chat-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ Strategy Confirmation Live</h1>
            <div class="ticker-input">
                <input type="text" id="tickerInput" placeholder="Ingresa ticker" value="XAUUSD">
                <button id="analyzeBtn">Confirmar Estrategia</button>
            </div>
            
            <!-- Botones rÃ¡pidos para tus pares favoritos -->
            <div class="quick-pairs">
                <button class="pair-btn" data-pair="EURUSD">ğŸ‡ªğŸ‡º EUR/USD</button>
                <button class="pair-btn" data-pair="AUDUSD">ğŸ‡¦ğŸ‡º AUD/USD</button>
                <button class="pair-btn" data-pair="XAUUSD">ğŸ¥‡ XAU/USD</button>
                <button class="pair-btn" data-pair="USDJPY">ğŸ‡ºğŸ‡¸ USD/JPY</button>
                <button class="pair-btn" data-pair="USDCHF">ğŸ‡ºğŸ‡¸ USD/CHF</button>
                <button class="pair-btn" data-pair="EURJPY">ğŸ‡ªğŸ‡º EUR/JPY</button>
                <button class="pair-btn" data-pair="AUDJPY">ğŸ‡¦ğŸ‡º AUD/JPY</button>
                <button class="pair-btn" data-pair="GBPUSD">ğŸ‡¬ğŸ‡§ GBP/USD</button>
                <button class="pair-btn" data-pair="GBPCAD">ğŸ‡¬ğŸ‡§ GBP/CAD</button>
            </div>
        </header>

        <main>
            <!-- Resultado Final Principal -->
            <div class="final-verdict">
                <div class="verdict-card" id="finalVerdict">
                    <h2>ğŸ” AnÃ¡lisis Final</h2>
                    <div id="verdictDirection">--</div>
                    <div id="verdictConfidence">--</div>
                    <div id="verdictTimeframe">15min Timeframe</div>
                </div>
            </div>

            <!-- Grid de AnÃ¡lisis -->
            <div class="analysis-grid">
                <!-- NUEVA SECCIÃ“N: Trade Recommendation -->
                <div class="card trade-recommendation-card">
                    <h3>ğŸ¯ RecomendaciÃ³n de Trade (15min)</h3>
                    <div id="tradeRecommendation">
                        <div class="waiting-analysis">
                            Esperando anÃ¡lisis completo...
                        </div>
                    </div>
                </div>

                <!-- Datos de OANDA -->
                <div class="card oanda-card">
                    <h3>ğŸ¦ OANDA Live</h3>
                    <div id="oandaPrice">--</div>
                    <div id="oandaSpread">--</div>
                    <div id="oandaVolume">--</div>
                    <div id="oandaStatus" class="data-status">Desconectado</div>
                </div>

                <!-- Datos de Investing.com -->
                <div class="card investing-card">
                    <h3>ğŸ“Š Investing.com</h3>
                    <div id="investingOverview">--</div>
                    <div id="investingSignals">--</div>
                    <div id="investingStatus" class="data-status">Desconectado</div>
                </div>

                <!-- Noticias y Alertas -->
                <div class="card news-card">
                    <h3>ğŸ“° Noticias & Alertas</h3>
                    <div id="newsOverview">--</div>
                    <div id="marketImpact">--</div>
                    <div id="newsWarnings">--</div>
                    <div id="newsStatus" class="data-status">Sin datos</div>
                </div>

                <!-- Indicadores Combinados -->
                <div class="card indicators-card">
                    <h3>ğŸ”„ Indicadores Combinados</h3>
                    <div class="indicator-list">
                        <div id="trendScore" class="indicator">--</div>
                        <div id="momentumScore" class="indicator">--</div>
                        <div id="volumeScore" class="indicator">--</div>
                        <div id="supportResistance" class="indicator">--</div>
                    </div>
                </div>
                
                <!-- ConfirmaciÃ³n de Estrategia -->
                <div class="card confirmation-card">
                    <h3>âœ… ConfirmaciÃ³n de Estrategia</h3>
                    <div id="strategyPoints">
                        <div id="bullishPoints" class="point bullish">--</div>
                        <div id="bearishPoints" class="point bearish">--</div>
                        <div id="neutralPoints" class="point neutral">--</div>
                    </div>
                    <div id="riskLevel">--</div>
                </div>
            </div>

            <!-- NUEVA SECCIÃ“N: Order Flow & Liquidez -->
            <div class="orderflow-section">
                <h2>ğŸ’§ Order Flow & AnÃ¡lisis de Liquidez</h2>
                <div class="orderflow-grid">
                    <!-- Liquidez Actual -->
                    <div class="card liquidity-card">
                        <h3>ğŸ’° Liquidez del Mercado</h3>
                        <div id="liquidityLevel">--</div>
                        <div id="liquidityTrend">--</div>
                        <div class="liquidity-bars" id="liquidityBars">
                            <div class="bar bid-bar">
                                <span>BID</span>
                                <div class="bar-fill" id="bidBar"></div>
                            </div>
                            <div class="bar ask-bar">
                                <span>ASK</span>
                                <div class="bar-fill" id="askBar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Flow -->
                    <div class="card orderflow-card">
                        <h3>ğŸŒŠ Order Flow</h3>
                        <div id="orderFlowDirection">--</div>
                        <div id="orderFlowStrength">--</div>
                        <div class="flow-indicator">
                            <div class="flow-arrow buy-flow" id="buyFlow">
                                <span>ğŸ“ˆ COMPRA</span>
                                <div class="arrow-fill"></div>
                            </div>
                            <div class="flow-arrow sell-flow" id="sellFlow">
                                <span>ğŸ“‰ VENTA</span>
                                <div class="arrow-fill"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Imbalances -->
                    <div class="card imbalance-card">
                        <h3>âš–ï¸ Imbalances</h3>
                        <div id="imbalanceStatus">--</div>
                        <div class="imbalance-list">
                            <div class="imbalance-item">
                                <span>PrÃ³ximo Nivel:</span>
                                <span id="nextLevel">--</span>
                            </div>
                            <div class="imbalance-item">
                                <span>Zona CrÃ­tica:</span>
                                <span id="criticalZone">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Perfil de Volumen -->
                    <div class="card volume-profile-card">
                        <h3>ğŸ“Š Perfil de Volumen</h3>
                        <div id="volumeProfile">--</div>
                        <div class="volume-levels">
                            <div class="level-item">
                                <span>POC:</span>
                                <span id="pocLevel">--</span>
                            </div>
                            <div class="level-item">
                                <span>VPOC:</span>
                                <span id="vpocStrength">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PredicciÃ³n de Movimiento -->
                <div class="prediction-section">
                    <div class="card prediction-card">
                        <h3>ğŸ”® PredicciÃ³n de Movimiento (PrÃ³ximos 15min)</h3>
                        <div class="prediction-content">
                            <div class="prediction-main">
                                <div id="predictionDirection">--</div>
                                <div id="predictionProbability">--</div>
                            </div>
                            <div class="prediction-details">
                                <div class="prediction-item">
                                    <span>ğŸ¯ Precio Objetivo:</span>
                                    <span id="targetPrice">--</span>
                                </div>
                                <div class="prediction-item">
                                    <span>â±ï¸ Tiempo Estimado:</span>
                                    <span id="estimatedTime">--</span>
                                </div>
                                <div class="prediction-item">
                                    <span>ğŸ›‘ Stop Level:</span>
                                    <span id="stopLevel">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones -->
            <div class="actions-section">
                <h3>ğŸ›ï¸ Acciones</h3>
                <div class="action-buttons">
                    <button id="saveAnalysis" class="action-btn">ğŸ’¾ Guardar AnÃ¡lisis</button>
                    <button id="exportData" class="action-btn">ğŸ“¤ Exportar Datos</button>
                    <button id="clearHistory" class="action-btn">ğŸ—‘ï¸ Limpiar Historial</button>
                </div>
            </div>

            <!-- ğŸ¤– AI CHAT ADVISOR SECTION -->
            <div class="ai-chat-section">
                <div class="chat-toggle-btn" id="chatToggleBtn">
                    <span class="chat-icon">ğŸ¤–</span>
                    <span class="chat-text">AI Trading Advisor</span>
                    <span class="chat-indicator" id="chatIndicator"></span>
                </div>
                
                <div class="chat-panel" id="chatPanel">
                    <div class="chat-header">
                        <div class="chat-title">
                            <span class="chat-avatar">ğŸ¤–</span>
                            <div class="chat-info">
                                <h4>AI Trading Advisor</h4>
                                <small>DeepSeek V3 â€¢ Especializado en Trading</small>
                            </div>
                        </div>
                        <div class="chat-controls">
                            <button class="chat-clear-btn" id="chatClearBtn" title="Limpiar Chat">
                                <span>ğŸ—‘ï¸</span>
                            </button>
                            <button class="chat-clear-btn" id="chatConfigBtn" title="Configurar API Key">
                                <span>ğŸ”‘</span>
                            </button>
                            <button class="chat-clear-btn" id="chatModelBtn" title="Cambiar Modelo IA">
                                <span>ğŸ¤–</span>
                            </button>
                            <button class="chat-clear-btn" id="chatExpandBtn" title="Expandir Chat">
                                <span>ğŸ”</span>
                            </button>
                            <button class="chat-close-btn" id="chatCloseBtn" title="Cerrar">
                                <span>âœ•</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-ticker-info" id="chatTickerInfo">
                        <span class="ticker-label">Analizando:</span>
                        <span class="ticker-value" id="chatCurrentTicker">XAUUSD</span>
                        <span class="ticker-status" id="chatTickerStatus">â—</span>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div class="welcome-message">
                            <div class="message ai-message">
                                <div class="message-avatar">ğŸ¤–</div>
                                <div class="message-content">
                                    <p>Â¡Hola! Soy tu AI Trading Advisor especializado. ğŸ“ˆ</p>
                                    <p>Puedo ayudarte con:</p>
                                    <ul>
                                        <li>ğŸ” AnÃ¡lisis de tu estrategia actual</li>
                                        <li>ğŸ“Š InterpretaciÃ³n de datos de mercado</li>
                                        <li>âš¡ AnÃ¡lisis de screenshots/grÃ¡ficos</li>
                                        <li>ğŸ’¡ Sugerencias de trading</li>
                                    </ul>
                                    <p><strong>Â¿En quÃ© puedo ayudarte con <span class="ticker-highlight">XAUUSD</span>?</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="image-upload-zone" id="imageUploadZone">
                            <input type="file" id="imageInput" accept="image/*" multiple hidden>
                            <div class="upload-prompt">
                                <span class="upload-icon">ğŸ“·</span>
                                <span class="upload-text">
                                    Arrastra imÃ¡genes aquÃ­, haz clic o pega (Ctrl+V)
                                    <small>PNG, JPG, GIF, WEBP - MÃ¡x 10MB</small>
                                </span>
                            </div>
                        </div>
                        
                        <div class="image-preview-container" id="imagePreviewContainer"></div>
                        
                        <div class="chat-input-container">
                            <textarea 
                                id="chatInput" 
                                placeholder="PregÃºntame sobre tu estrategia de trading, anÃ¡lisis tÃ©cnico, o sube una imagen para analizar..."
                                rows="1"></textarea>
                            <div class="input-actions">
                                <button class="image-btn" id="imageBtn" title="Subir imagen">
                                    <span>ğŸ“·</span>
                                </button>
                                <button class="send-btn" id="sendBtn" title="Enviar mensaje">
                                    <span>ğŸ“¤</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="typing-indicator" id="typingIndicator">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <span class="typing-text">AI analizando...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historial Compacto -->
            <div class="history-compact">
                <h3>ğŸ“‹ Historial Reciente</h3>
                <div id="recentAnalysis">
                    <!-- Los anÃ¡lisis recientes aparecerÃ¡n aquÃ­ -->
                </div>
            </div>
        </main>
    </div>

    <!-- Chat Overlay para modo expandido -->
    <div class="chat-overlay" id="chatOverlay"></div>

    <!-- Scripts en el ORDEN CORRECTO - CRÃTICO -->
    <script src="convertToOandaFormat.js"></script>
    <script src="dual-source-api.js"></script>
    <script src="oanda-api.js"></script>
    <script src="investing-scraper.js"></script>
    <script src="orderflow-analyzer.js"></script>
    <script src="strategy-engine.js"></script>
    <script src="twelvedata-api.js"></script>
    <script src="trade-recommender.js"></script>
    <script src="data-quality-manager.js"></script>
    <!-- ğŸ¤– AI CHAT ADVISOR SCRIPTS -->
    <script src="chat-storage-manager.js"></script>
    <script src="image-upload-handler.js"></script>
    <script src="ai-chat-advisor.js"></script>
    <script src="script.js"></script>
    
    <!-- Script de debugging para verificar carga -->
    <script>
        console.log('ğŸ” Verificando carga de scripts...');
        setTimeout(() => {
            console.log('ğŸ“‹ Estado final de scripts:', {
                convertToOandaFormat: typeof window.convertToOandaFormat,
                OandaAPI: typeof window.OandaAPI,
                InvestingScraper: typeof window.InvestingScraper,
                OrderFlowAnalyzer: typeof window.OrderFlowAnalyzer,
                StrategyEngine: typeof window.StrategyEngine,
                TradeRecommender: typeof window.TradeRecommender,
                // ğŸ¤– AI Chat Scripts
                ChatStorageManager: typeof window.ChatStorageManager,
                ImageUploadHandler: typeof window.ImageUploadHandler,
                AIChatAdvisor: typeof window.AIChatAdvisor
            });
        }, 500);
    </script>
</body>
</html>
